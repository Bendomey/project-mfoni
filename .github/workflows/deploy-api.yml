name: Build Api

on:
  workflow_call:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - uses: actions/checkout@v4
        - name: Setup dotnet
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: '8.0'

        - uses: actions/cache@v3
          with:
              path: ~/.nuget/packages
              # Look to see if there is a cache hit for the corresponding requirements file
              key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
              restore-keys: |
                ${{ runner.os }}-nuget

        - name: Install dependencies
          run: dotnet restore
          working-directory: services/main

        - name: Prod Env
          id: create-json
          uses: jsdaniell/create-json@v1.2.2
          with:
            name: "appsettings.Production.json"
            json: ${{ secrets.PRODUCTION_ENV }}
            dir: 'services/main'

        - name: Build Release
          run: dotnet publish -c Release -o out
          working-directory: services/main
